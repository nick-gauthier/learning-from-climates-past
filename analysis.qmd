---
title: "Lessons of the Past data analysis"
author: Nick Gauthier
date: "Last updated: `r Sys.Date()`"
format: 
  typst:
    toc: true
    margin:
      x: 1in
      y: 1in
editor: visual
---

```{r echo = FALSE}
#hide code chunks but show ouptuts
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

```{r setup}
# Load required packages
library(tidyverse) # for data manipulation
library(googlesheets4) # for pulling data from Google Sheets
library(patchwork) # for combining plots
library(gtsummary) # for summary tables
library(labelled) # for informative variable names

theme_set(theme_bw()) # set default plot theme to black and white
theme_gtsummary_compact() # set default theme for tables

# how many digits to percentages to
digits <- 0

# read the Google Sheet, done here so we only do it once per session
dat_raw <- read_sheet("https://docs.google.com/spreadsheets/d/1Oz1VSN4xjyeRdV7C8fGSPQ_ni6FevMxL0EAji3x9Gp0/edit?gid=1797047085#gid=1797047085") 

# category names for use elsewhere
discipline_names <- c('Archaeology', 
                        'Economics', 
                        'Literature', 
                        'Geography', 
                        'History', 
                        'Paleoclimatology', 
                        'Epidemiology', 
                        'Other', 
                        'Joint Fields')
method_names <- c('Qualitative', 
                    'Quantitative', 
                    'Both', 
                    'Neither')
type_names <- c('Original Research', 
                    'Lit. Review/Method Intervention', 
                    'Response Article')
rec_type_names <- c(c('Broad, abstract, or vague', 
                       'Specific but not actionable', 
                       'Specific and actionable for policymakers', 
                       'Any two of the above', 
                       'All three of the above', 
                       'None of the above'))
rec_types <- c('Broad, abstract, or vague',
               'Specific but not actionable',
               'Specific and actionable',
               NA,
               NA,
               'No recommendation')

american_regions <- c('South America', "North America", "Caribbean", 
                                        "Central America, South America", 'Central America')

periods <- c('Pleistocene',
             'Early-Mid Holocene',
             'Ancient',
             'Medieval',
             'Early Modern',
             'Modern',
             'Present')
```

Note: This analysis pulls data directly from the Google Sheet [here](https://docs.google.com/spreadsheets/d/1Oz1VSN4xjyeRdV7C8fGSPQ_ni6FevMxL0EAji3x9Gp0/edit?gid=1797047085#gid=1797047085), so the plots should update automatically as the spreadsheet changes.

```{r preprocessing}
# should update so we save the named list of periods in "periods" right away
dat <- dat_raw |>
  rename(date = `DATE (BY YEAR AFTER 1975)`, 
         title = `TITLE OF PUBLICATION`,
         method = `TYPE OF ARTICLE 1`,
         type = `TYPE OF ARTICLE 2`,
         discipline = `DISCIPLINE (SEE SHEET 2)`,
         region = `GEOGRAPHIC REGION (SEE SHEET 2)`,
         period = `PERIOD (SEE SHEET 2)`,
         pub_type = `BOOK, THESIS, ARTICLE, CHAPTER?`,
         journal = `JOURNAL TITLE OR BOOK PUBLISHER`,
         argument = `ARGUMENT (ONE SENTENCE)`,
         agw = `DOES ARTICLE USE MODERN ANTHROPOGENIC CLIMATE CHANGE TO ARGUE FOR ITS IMPORTANCE? (Y/N)`,
         rec = `DOES ARTICLE INCLUDE LESSONS OR RECOMMENDATIONS FOR THE PRESENT OR FUTURE (Y/N)?`,
         rec_type = `TYPE OF RECOMMENDATION (SEE SHEET 2)`,
         lesson_text = `LESSONS OR RECOMMENDATIONS FOR THE PRESENT OR FUTURE (ONE SENTENCE)`) |>
  mutate(discipline = discipline_names[discipline],
         method = method_names[method],
         type = type_names[type],
         region = if_else(region %in% american_regions, 'Americas', region),
         region = if_else(region == 'Southern Hemisphere', 'Global', region),
         region = if_else(region == 'Australia', 'Oceania', region),
         region = if_else(region %in% c('Arctic', 'Antarctic'), 'Polar', region),
         region = if_else(title %in% 
                            c('On the Interpretation of Natural Archives of Atlantic Tropical Cyclone Activity', 
                              'On the extraordinary winter flood episode over the North Atlantic Basin in 1936'),
                          'Global', region),
         region = if_else(title == 'Climate change facilitated the early colonization of the Azores Archipelago during medieval times', 'Europe', region),
         region = if_else(region == 'N/A', 'Global', region),
         rec_type = as.character(rec_type)
         # rec_type = rec_type_names[rec_type]
         ) |>
  mutate(period = as.character(period),
         period = map(period, ~str_split_1(.x, ',') |>
                            as.numeric() %>%
                        periods[.] |>
                        factor(levels = periods))) |>
  filter(pub_type != 'Blog Post') |>
  # add labels so tables are easier to read
  set_variable_labels(discipline = 'Discipline',
                      region = 'Geographic Region',
                      method = 'Method', 
                      period = 'Period',
                      pub_type = 'Publication Type',
                      agw = 'Uses AGW',
                      rec = 'Includes lessons'
) #|>
  #set_value_labels(agw = c('Uses AGW' = 'Yes', 'Does not use AGW' = 'No'))
```

## Simple Questions

### 1.  How many publications do we have from each discipline?

```{r tbl1}
dat |>
  select(discipline) |>
  tbl_summary() |>
  modify_header(label = "**Variable**") |>
  bold_labels()
```

### 2.  How many publications are from each region?

```{r tbl2}
dat |>
  select(region) |>
  tbl_summary() |>
  modify_header(label = "**Variable**") |>
  bold_labels()
```

### 3.  How many publications are from each period?

Note that N is larger here because each paper can cover multiple time periods.

```{r tbl3}
dat |>
  select(period) |>
  unnest(period) |>
  tbl_summary(label = list(period = 'Period')) |>
  modify_header(label = "**Variable**") |>
  bold_labels()
```

### 4.  How many of our publications use methods that are quantitative, statistical, both, or neither?

```{r tbl4}
dat |>
  select(method) |>
  tbl_summary() |>
  modify_header(label = "**Variable**") |>
  bold_labels()
```

### 5.  How many of our publications are original research, a literature review, or a response article?

```{r tbl5}
dat |>
  select(type) |>
  tbl_summary() |>
  modify_header(label = "**Variable**") |>
  bold_labels()
```

### 6.  How many of our publications are books, "book/theses" (meaning PhD theses), articles, or "chapter/articles" (meaning book chapters)?

```{r tbl6}
dat |>
  select(pub_type) |>
  tbl_summary() |>
  modify_header(label = "**Variable**") |>
  bold_labels()
```

### 7.  How many of our publications use AGW to argue for their importance?

```{r tbl7}
dat |>
  select(agw) |>
  tbl_summary() |>
  modify_header(label = "**Variable**") |>
  bold_labels()
```

### 8.  How many of our publications include lessons for the present/future?

```{r tbl8}
dat |>
  select(rec) |>
  tbl_summary() |>
  modify_header(label = "**Variable**") |>
  bold_labels()
```

### 9.  What types of lessons or recommendations are most common?

Also trickier because of multiple responses per row. I did it this way, but Dagomar may want "For all questions involved lessons, I converted "1,2", "1,3" and "2,3" into 4, and "1,2,3" into "5.""

So may want to double check this and the next one to use rec_type, or rec_type names

```{r tbl9}
dat |>
  pull(rec_type) |> 
  str_split(',') |>
  list_c() |>
  as.numeric() |>
  table() |>
  enframe(name = 'rec_type', value = 'n') |>
  mutate(rec_type = factor(rec_types[as.numeric(rec_type)], levels = rec_types))
```

### 10. Among lessons (so leaving out "none of the above") what types of lessons or recommendations are most common?

```{r tbl10}
dat |>
  pull(rec_type) |> 
  str_split(',') |>
  list_c() |>
  as.numeric() |>
  table() |>
  enframe(name = 'rec_type', value = 'n') |>
  mutate(rec_type = factor(rec_types[as.numeric(rec_type)], levels = rec_types)) 
```

### 11. How many of our publications in each discipline use methods that are quantitative, qualitative, both, or neither?

```{r tbl11}
dat |>
  select(discipline, method) |>
  tbl_summary(by = method) |>
  modify_header(label = "**Variable**") |>
  bold_labels()
```

### 12. How many publications that are *not* in Paleoclimatology/Historical Climatology use Quantitative Analysis?

```{r tbl12}
dat |>
  filter(discipline != 'Paleoclimatology',
         method %in% c('Both', 'Quantitative')) |>
  nrow()
```

### 13. What percentage of publications in every method consider each region?

```{r tbl13}
dat |>
  select(region, method) |>
  tbl_summary(by = method) |>
  modify_header(label = "**Variable**") |>
  bold_labels() |>
  add_p(test.args = all_tests("fisher.test") ~ list(simulate.p.value=TRUE))
```

### Figures for simple questions

#### Figure 1: a chart/graph showing answers to questions 1-3.

```{r fig1, fig.width = 10.5, fig.asp = .3}
a <- dat |>
  count(discipline) |>
  ggplot(aes(reorder(discipline, n), n)) +
  geom_col() +
  coord_flip() +
  labs(title = "Discipline",
       x = "",
       y = "Publications")

b <- dat |>
  count(region) |>
  ggplot(aes(reorder(region, n), n)) +
  geom_col() +
  coord_flip() +
  labs(title = "Region",
       x = "",
       y = "Publications")

c <- dat |>
  select(period) |>
  unnest(period) |>
  count(period) |>
  ggplot(aes(period, n)) +
  geom_col() +
  coord_flip() +
  labs(title = "Period",
       x = "",
       y = "Publications")

a + b + c
```

#### Figure 2: a chart/graph showing answers to questions 4-6.

```{r fig2, fig.width = 10.5, fig.asp = .3}
d <- dat |>
  count(method) |>
  ggplot(aes(reorder(method, n), n)) +
  geom_col() +
  coord_flip() +
  labs(title = "Approach",
       x = "",
       y = "Publications")
e <- dat |>
  count(type) |>
  ggplot(aes(reorder(type, n), n)) +
  geom_col() +
  coord_flip() +
  labs(title = "Context",
       x = "",
       y = "Publications")
f <- dat |>
  count(pub_type) |>
  ggplot(aes(reorder(pub_type, n), n)) +
  geom_col() +
  coord_flip() +
  labs(title = "Type",
       x = "",
       y = "Publications")

d + e + f
```

#### Figure 3: a chart/graph showing answers to questions 7-9.

```{r fig3, fig.width = 9, fig.asp = .3}
g <- dat |>
  count(agw) |>
  ggplot(aes(reorder(agw, n), n)) +
  geom_col() +
  coord_flip() +
  labs(title = "Use of AGW for Justification",
       x = "",
       y = "Publications")

h <- dat |>
  count(rec) |>
  ggplot(aes(reorder(rec, n), n)) +
  geom_col() +
  coord_flip() +
  labs(title = "Lessons for the Future?",
       x = "",
       y = "Publications")

## double check that this is correct given the shared categories
i <- dat |>
  pull(rec_type) |> 
  map_chr(as.character) |>
  str_split(',') |>
  list_c() |>
  as.numeric() |>
  table() |>
  enframe(name = 'rec_type', value = 'n') |>
  mutate(rec_type = factor(rec_types[as.numeric(rec_type)], levels = rec_types),
         n = as.numeric(n)) |>
  ggplot(aes(reorder(rec_type, n), n)) +
  geom_col() +
  coord_flip() +
  labs(title = "Type of Lesson",
       x = "",
       y = "Publications")

g + h + i
```

## Compound Questions

### 1a. What percentage of publications in each discipline use AGW to argue for their importance?

```{r}
dat |>
  select(discipline, agw) |>
  tbl_summary(by = agw) |>
  modify_header(label = "**Variable**") |>
  bold_labels() |>
  add_p(test.args = all_tests("fisher.test") ~ list(simulate.p.value=TRUE))
```

### 1b. What percentage of publications in each method use AGW to argue for their importance?

```{r}
dat |>
  select(method, agw) |>
  tbl_summary(by = agw) |>
  modify_header(label = "**Variable**") |>
  bold_labels() |>
  add_p()
```

### 2a. What percentage of publications in Paleoclimatology/Historical Climatology use modern global warming to argue for their significance? What percentage of publications in all *other* disciplines do the same?

```{r}
dat |>
    mutate(paleo = if_else(discipline == 'Paleoclimatology', discipline, 'All other disciplines')) |>
  select(paleo, agw) |>
  tbl_summary(by = paleo) |>
  modify_header(label = "**Variable**") |>
  bold_labels() |>
  add_p()
```

### 2b. What percentage of publications using quantitative analysis use modern global warming to argue for their significance? And what percentage of publications using the other methods do the same?

Note that here we again combine Quantitative and Both categories.

```{r}
dat |>
  mutate(quant = if_else(method %in% c('Quantitative', 'Both'), 'Quantitative', 'Other Methods')) |>
  select(quant, agw) |>
  tbl_summary(by = quant) |>
  modify_header(label = "**Variable**") |>
  bold_labels() |>
  add_p()
```

### 3a. What percentage of publications from each region use AGW to argue for their importance?

```{r}
dat |>
  select(region, agw) |>
  tbl_summary(by = region) |>
  modify_header(label = "**Variable**") |>
  bold_labels() |>
  add_p() |>
  as_gt()

dat |>
  select(region, agw) |>
  tbl_summary(by = agw) |>
  modify_header(label = "**Variable**") |>
  bold_labels() |>
  add_p()
```

### 3b. What percentage of publications from each period use AGW to argue for their importance?

```{r}
dat |>
  select(period, agw) |>
  unnest(period) |>
  tbl_summary(by = period) |>
  modify_header(label = "**Variable**") |>
  bold_labels() |>
  add_p()
```

This analysis the sums are 100 by AGW

```{r}
dat |>
  add_count(agw) |>
  filter(agw == 'Yes') |>
  group_by(region) |>
  summarize(percent = round(n() / first(n) * 100, digits = digits))
```

We may want to do this differently, right now denominator is the original number of papers, not expanded. so it doesn't add to 100%

```{r}
dat |>
  add_count(agw) |>
  filter(agw == 'Yes') |>
  select(period, n) |>
  unnest(period) |>
  group_by(period) |>
  summarize(percent = round(n() / first(n) * 100, digits))
```

This analysis the sums are 100 per region

```{r}
dat |>
  count(region, agw) |>
  group_by(region) |>
  mutate(total = sum(n),
         percent = round(n / total * 100, digits = digits)) |>
  filter(agw == 'Yes') |>
  select(region, percent) |>
  ungroup()
```



Same but for periods

```{r}
dat |>
  select(period, agw) |>
  unnest(period) |>
  count(period, agw)  |>
  group_by(period) |>
mutate(total = sum(n),
         percent = round(n / total * 100, digits = digits)) |>
  filter(agw == 'Yes') |>
  select(period, percent) |>
  ungroup()
```


### 5.  What percentage of publications that include lessons come from each discipline? What percentage comes from each method?

```{r}
dat |>
  select(rec, discipline, method) |>
  tbl_summary(by = rec) |>
  modify_header(label = "**Variable**") |>
  bold_labels() |>
  add_p(test.args = all_tests("fisher.test") ~ list(simulate.p.value=TRUE))
```

### 6a. What percentage of publications in each discipline include lessons for the present/future?

```{r}
dat |>
  select(rec, discipline) |>
  tbl_summary(by = discipline) |>
  modify_header(label = "**Variable**") |>
  bold_labels() |>
  add_p(test.args = all_tests("fisher.test") ~ list(simulate.p.value=TRUE))
```

### 6b. What percentage of publications in each method include lessons for the present/future?

```{r}
dat |>
  select(rec, method) |>
  tbl_summary(by = method) |>
  modify_header(label = "**Variable**") |>
  bold_labels() |>
  add_p()
```


### 7.  What percentage of publications that include lessons focus on each region and period?

```{r}
dat |>
  select(region, rec) |>
  tbl_summary(by = rec) |>
  modify_header(label = "**Variable**") |>
  bold_labels() |>
  add_p(test.args = all_tests("fisher.test") ~ list(simulate.p.value=TRUE))
```

There might be better ways do this, need to think through how multi-counting papers impacts significance!

```{r}
dat |>
  select(period, rec) |>
  unnest(period) |>
  tbl_summary(by = rec) |>
  modify_header(label = "**Variable**") |>
  bold_labels() |>
  add_p()
```

(this is a slightly different version, like above we need to consider how best to handle multiple periods)

```{r}
dat |>
  filter(rec == 'Yes') |> #195
  select(period) |>
  unnest(period) |>
  count(period) |>
  mutate(percent = round(n / 195 * 100, digits = digits)) |> # shouldn't hard code this . . .
  select(-n)
```

### 8a. What percentage of publications from each region include lessons for the present/future?

```{r}
dat |>
  select(region, rec) |>
  tbl_summary(by = region) |>
  modify_header(label = "**Variable**") |>
  bold_labels() |>
  add_p(test.args = all_tests("fisher.test") ~ list(simulate.p.value=TRUE))
```

### 8b. What percentage of publications from each period include lessons for the present/future?

```{r}
dat |>
  select(period, rec) |>
  unnest(period) |>
  tbl_summary(by = period) |>
  modify_header(label = "**Variable**") |>
  bold_labels() |>
  add_p() |>
  as_gt()
```

### 9a. What percentage of publications in each discipline include distinct types of recommendation?

```{r}
dat |>
  select(discipline, rec_type) |>
  tbl_summary(by = discipline) |>
  modify_header(label = "**Variable**") |>
  bold_labels() |>
  add_p(test.args = all_tests("fisher.test") ~ list(simulate.p.value=TRUE)) |>
  as_gt()
```

### 9b. What percentage of publications in each method include distinct types of recommendation?

```{r}
dat |>
  select(method, rec_type) |>
  tbl_summary(by = method) |>
  modify_header(label = "**Variable**") |>
  bold_labels() |>
  add_p(test.args = all_tests("fisher.test") ~ list(simulate.p.value=TRUE)) |>
  as_gt()
```

### 10a. What percentage of publications from each region include distinct types of recommendation?

```{r}
dat |>
  select(region, rec_type) |>
  tbl_summary(by = region) |>
  modify_header(label = "**Variable**") |>
  bold_labels() |>
  add_p(test.args = all_tests("fisher.test") ~ list(simulate.p.value=TRUE)) |>
  as_gt()
```

### 10b. What percentage of publications from each period include distinct types of recommendation?

```{r}
dat |>
  select(period, rec_type) |>
  unnest(period) |>
  tbl_summary(by = period) |>
  modify_header(label = "**Variable**") |>
  bold_labels() |>
  add_p(test.args = all_tests("fisher.test") ~ list(simulate.p.value=TRUE)) |>
  as_gt()
```

### 11. What percentage of publications that use AGW to argue for their importance include lessons for the present/future?

```{r}
dat |>
  select(agw, rec) |>
  tbl_summary(by = agw) |>
  modify_header(label = "**Variable**") |>
  bold_labels() |>
  add_p() |>
  as_gt()
```

```{r}
dat |>
  ggplot(aes(agw)) +
  geom_bar(aes(fill = rec), position = "fill") +
  theme_minimal() +
  labs(title = "Percentage of Publications Including Lessons for the Present/Future by AGW Use",
       x = "AGW Use",
       y = "Percentage of Publications",
       fill = "Lessons for Present/Future")
```

What percentage of palaeosciences/history/literature, etc. articles that use AGW to argue for their importance include lessons for the present/future?

```{r}
dat |>
  filter(agw == 'Yes') |>
  select(discipline, rec) |>
  tbl_summary(by = discipline) |>
  modify_header(label = "**Variable**") |>
  bold_labels() |>
  add_p(test.args = all_tests("fisher.test") ~ list(simulate.p.value=TRUE)) |>
  as_gt()
```

```{r}
dat |>
  filter(agw == 'Yes') |>
  ggplot(aes(discipline)) +
  geom_bar(aes(fill = rec), position = "fill") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Percentage of Publications that Use AGW for Justification Including Lessons for the Present/Future by Discipline",
       x = "Discipline",
       y = "Percentage of Publications",
       fill = "Lessons for Present/Future")
```

Broken down by region:

```{r}
dat |>
  filter(agw == 'Yes') |>
  select(region, rec) |>
  tbl_summary(by = region) |>
  modify_header(label = "**Variable**") |>
  bold_labels() |>
  add_p(test.args = all_tests("fisher.test") ~ list(simulate.p.value=TRUE)) |>
  as_gt()
```


Broken down by period:

```{r}
dat |>
  filter(agw == 'Yes') |>
  select(period, rec) |>
  unnest(period) |>
  tbl_summary(by = period) |>
  modify_header(label = "**Variable**") |>
  bold_labels() |>
  add_p() |>
  as_gt()
```

```{r}
#TODO
```

Broken down by method:

```{r}
dat |>
  filter(agw == 'Yes') |>
  select(method, rec) |>
  tbl_summary(by = method) |>
  modify_header(label = "**Variable**") |>
  bold_labels() |>
  add_p()
```

Broken down by publication type:

```{r}
dat |>
  filter(agw == 'Yes') |>
  select(type, rec) |>
  tbl_summary(by = type) |>
  modify_header(label = "**Variable**") |>
  bold_labels() |>
  add_p(test.args = all_tests("fisher.test") ~ list(simulate.p.value=TRUE))
```

Broken down by publication format:

```{r}
dat |>
  filter(agw == 'Yes') |>
  select(pub_type, rec) |>
  tbl_summary(by = pub_type) |>
  modify_header(label = "**Variable**") |>
  bold_labels() |>
  add_p()
```


### 12. Are there journals which are particularly correlated with including lessons for the present/future?

Of the journals with 10 or more entries in our database, the following journals have the highest proportion of papers with recommendations for the present or future. However, only Climate and American Literature has a significantly higher proportion of recommendations than the average for all papers, after correcting for multiple comparisons.

```{r}
prop <- dat |>
  select(rec) |>
  mutate(rec = (rec == 'Yes')) |>
  pull(rec) |>
  mean()

dat |>
  mutate(rec = (rec == 'Yes')) |>
  group_by(journal) |>
  summarise(
    n_papers = n(),
    n_recs = sum(rec),
    prop_recs = mean(rec),
    # Run binomial test for each journal
    pval = binom.test(n_recs, n_papers, p = prop)$p.value
  ) |>
  # Filter to journals with reasonable sample sizes
  filter(n_papers >= 10) %>%
  # Add FDR correction
  mutate(
    p_adj = p.adjust(pval, method = "fdr"),
    # Flag significant ones
    significant = p_adj < 0.05
  ) %>%
  arrange(desc(prop_recs))
```

Check by absolute counts.

```{r}
dat |>
  filter(rec == 'Yes') |>
  count(journal) |>
  arrange(-n)
```

Now by percentages.

```{r}
dat |>
  count(journal, rec) |>
  group_by(journal) |>
  mutate(n_tot = sum(n)) |>
  ungroup() |>
  filter(rec == 'Yes') |>
  mutate(pct = round((n / n_tot) * 100, digits = digits)) |>
  select(journal, pct, n_tot) |>
  arrange(-pct, -n_tot)
```

## Compund figures

```{r}
dat |>
  ggplot(aes(discipline)) +
  geom_bar(aes(fill = agw), position = "fill") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Percentage of Publications Using AGW to Argue for Importance by Discipline",
       x = "Discipline",
       y = "Percentage of Publications",
       fill = "AGW Use")

dat |>
  ggplot(aes(method)) +
  geom_bar(aes(fill = agw), position = "fill") +
  theme_minimal() +
  labs(title = "Percentage of Publications Using AGW to Argue for Importance by Method",
       x = "Method",
       y = "Percentage of Publications",
       fill = "AGW Use")

dat |>
  ggplot(aes(type)) +
  geom_bar(aes(fill = agw), position = "fill") +
  theme_minimal() +
  labs(title = "Percentage of Publications Using AGW to Argue for Importance by Method",
       x = "Method",
       y = "Percentage of Publications",
       fill = "AGW Use")
```

```{r}
dat |>
  filter(agw == 'Yes') |>
  ggplot(aes(method)) +
  geom_bar(aes(fill = rec), position = "fill") +
  theme_minimal() +
  labs(title = "Percentage of Publications that Use AGW for Justification Including Lessons for the Present/Future by Method",
       x = "Method",
       y = "Percentage of Publications",
       fill = "Lessons for Present/Future")
```

```{r}
#What percentage of publications from each region and period include lessons for the present/future?

dat |>
  ggplot(aes(region)) +
  geom_bar(aes(fill = rec), position = "fill") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Percentage of Publications Including Lessons for the Present/Future by Region",
       x = "Region",
       y = "Percentage of Publications",
       fill = "Lessons for Present/Future")
```

```{r}
dat |>
  filter(agw == 'Yes') |>
  ggplot(aes(pub_type)) +
  geom_bar(aes(fill = rec), position = "fill") +
  theme_minimal() +
  labs(title = "Percentage of Publications that Use AGW for Justification Including Lessons for the Present/Future by Journal",
       x = "Journal",
       y = "Percentage of Publications",
       fill = "Lessons for Present/Future")
```

```{r}
dat |>
  ggplot(aes(discipline)) +
  geom_bar(aes(fill = rec), position = "fill") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Percentage of Publications Including Lessons for the Present/Future by Discipline",
       x = "Discipline",
       y = "Percentage of Publications",
       fill = "Lessons for Present/Future")

dat |>
  ggplot(aes(method)) +
  geom_bar(aes(fill = rec), position = "fill") +
  theme_minimal() +
  labs(title = "Percentage of Publications Including Lessons for the Present/Future by Method",
       x = "Method",
       y = "Percentage of Publications",
       fill = "Lessons for Present/Future")

dat |>
  ggplot(aes(type)) +
  geom_bar(aes(fill = rec), position = "fill") +
  theme_minimal() +
  labs(title = "Percentage of Publications Including Lessons for the Present/Future by Method",
       x = "Method",
       y = "Percentage of Publications",
       fill = "Lessons for Present/Future")
```

```{r}
dat |>
  filter(agw == 'Yes') |>
  ggplot(aes(type)) +
  geom_bar(aes(fill = rec), position = "fill") +
  theme_minimal() +
  labs(title = "Percentage of Publications that Use AGW for Justification Including Lessons for the Present/Future by Publication Type",
       x = "Publication Type",
       y = "Percentage of Publications",
       fill = "Lessons for Present/Future")
```

```{r}
dat |>
  select(period, agw) |>
  unnest(period) |>
  ggplot(aes(period)) +
  geom_bar(aes(fill = agw), position = "fill") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Percentage of Publications Using AGW to Argue for Importance by Period",
       x = "Period",
       y = "Percentage of Publications",
       fill = "AGW Use")
```
```{r}
dat |>
  filter(agw == 'Yes') |>
  ggplot(aes(region)) +
  geom_bar(aes(fill = rec), position = "fill") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Percentage of Publications that Use AGW for Justification Including Lessons for the Present/Future by Region",
       x = "Region",
       y = "Percentage of Publications",
       fill = "Lessons for Present/Future")
```
## Regression

```{r}
# should adjust baseline and try to incorporate more vars
dat2 <- mutate(dat, rec_bin = rec == 'Yes')
m1 <- glm(rec_bin ~ method + region + agw + discipline,
          family = binomial, data = dat2)
tbl_regression(m1) |>
  as_gt()
```
